const _ = require('lodash');

const arr2 = [
  {
    created_at: 1599829935916,
    updated_at: 1599829935916,
    id: '5f5b77afa872e4003d267b9e',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638049995,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'EURUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.18547,
    current_price: 1.18529,
    close_price: 1.18529,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -2.16,
    profit_pips: 0,
    lots: 0.12,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599837135000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5b77afa872e4003d267b9c',
    user: 1
  },
  {
    created_at: 1599829955294,
    updated_at: 1599829955295,
    id: '5f5b77c3a872e4003d267ba1',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638050292,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'GBPUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.28025,
    current_price: 1.28003,
    close_price: 1.28003,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -220,
    profit_pips: 0,
    lots: 10,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599837154000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5b77c3a872e4003d267b9f',
    user: 1
  },
  {
    created_at: 1599830023990,
    updated_at: 1599830023990,
    id: '5f5b7807a872e4003d267ba4',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638051260,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'EURUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.18545,
    current_price: 1.18527,
    close_price: 1.18527,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -180,
    profit_pips: 0,
    lots: 10,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599837223000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5b7807a872e4003d267ba2',
    user: 1
  },
  {
    created_at: 1599830580433,
    updated_at: 1599830580433,
    id: '5f5b7a34a872e4003d267ba7',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638058435,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'EURUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.18495,
    current_price: 1.18478,
    close_price: 1.18478,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -170,
    profit_pips: 0,
    lots: 10,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599837779000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5b7a34a872e4003d267ba5',
    user: 1
  },
  {
    created_at: 1599830614248,
    updated_at: 1599830614248,
    id: '5f5b7a56a872e4003d267baa',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638058880,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'AUDUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 0.72938,
    current_price: 0.72917,
    close_price: 0.72917,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -105,
    profit_pips: 0,
    lots: 5,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599837814000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5b7a56a872e4003d267ba8',
    user: 1
  },
  {
    created_at: 1599841155310,
    updated_at: 1599841155310,
    id: '5f5ba383e9ccad006e4dedff',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638163308,
    type: 'SELL',
    broker: 'MetaQuotes-Demo',
    symbol: 'USDJPY',
    initial_volume: 0,
    current_volume: 0,
    open_price: 106.152,
    current_price: 106.174,
    close_price: 106.174,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -0.21,
    profit_pips: 0,
    lots: 0.01,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599848354000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5ba383e9ccad006e4dedfd',
    user: 1
  },
  {
    created_at: 1599841164703,
    updated_at: 1599841164703,
    id: '5f5ba38ce9ccad006e4dee02',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638163361,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'USDCAD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.31797,
    current_price: 1.31772,
    close_price: 1.31772,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -0.19,
    profit_pips: 0,
    lots: 0.01,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599848364000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5ba38ce9ccad006e4dee00',
    user: 1
  },
  {
    created_at: 1599841857042,
    updated_at: 1599841857043,
    id: '5f5ba641e9ccad006e4dee05',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638167550,
    type: 'SELL',
    broker: 'MetaQuotes-Demo',
    symbol: 'GBPUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.27854,
    current_price: 1.27876,
    close_price: 1.27876,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -0.22,
    profit_pips: 0,
    lots: 0.01,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599849056000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5ba641e9ccad006e4dee03',
    user: 1
  },
  {
    created_at: 1599841865881,
    updated_at: 1599841865881,
    id: '5f5ba649e9ccad006e4dee08',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638167586,
    type: 'SELL',
    broker: 'MetaQuotes-Demo',
    symbol: 'USDJPY',
    initial_volume: 0,
    current_volume: 0,
    open_price: 106.149,
    current_price: 106.17,
    close_price: 106.17,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -0.2,
    profit_pips: 0,
    lots: 0.01,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599849065000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5ba649e9ccad006e4dee06',
    user: 1
  },
  {
    created_at: 1599841942004,
    updated_at: 1599842096624,
    id: '5f5ba696e9ccad006e4dee0b',
    is_deleted: false,
    created_by: 0,
    updated_by: 0,
    deleted_at: 0,
    deleted_by: 0,
    trade_id: 638168030,
    type: 'BUY',
    broker: 'MetaQuotes-Demo',
    symbol: 'EURUSD',
    initial_volume: 0,
    current_volume: 0,
    open_price: 1.18348,
    current_price: 1.18359,
    close_price: 1.18359,
    stop_loss: 0,
    stop_loss_pips: 0,
    take_profit: 0,
    take_profit_pips: 0,
    profit: -0.17,
    profit_pips: 0,
    lots: 0.01,
    swap: 0,
    commission: 0,
    risk: '',
    comment: '',
    reason: null,
    magic: 0,
    created_time: 1599849295000,
    updated_time: 0,
    completed_time: 0,
    expiration_time: 0,
    user_login: '76785012',
    is_closed: true,
    sync_created_time: 0,
    sync_updated_time: 0,
    trade_account: 1,
    post: '5f5ba695e9ccad006e4dee09',
    user: 1
  }
];

var arr = [
  { day: 1, week: 1, month: 1, year: 1, sym: 'A' }, // count: 1
  { day: 1, week: 1, month: 1, year: 1, sym: 'A' },
  { day: 2, week: 1, month: 1, year: 1, sym: 'B' },
  { day: 2, week: 1, month: 1, year: 1, sym: 'A' },
  { day: 3, week: 1, month: 1, year: 1, sym: 'C' },
  { day: 4, week: 1, month: 1, year: 1, sym: 'A' },
  { day: 5, week: 1, month: 1, year: 1, sym: 'B' },
  { day: 5, week: 1, month: 1, year: 1, sym: 'C' },
  { day: 5, week: 1, month: 1, year: 1, sym: 'D' },
];

// Example 1 - Groupby property
var t = _(arr2)
  .groupBy(o => o.symbol)
  .map((value, key) => ({ symbol: key, data: value.map(e => e.id) }))
  .value();
// console.log(t);


// Example 2 - Groupby multiple properties
var result = Object.values(arr.reduce((r, o) => {
  var key = o.day + '|' + o.week + '|' + o.month + '|' + o.year;

  if (!r[key]) {
    r[key] = o;
  } else {
    // console.log(r[key]);
    // r[key].count += o.count;
  }

  return r;
}, {}));

// console.log(result);

// Example 3 - Find and update object
var arr3 = [{ id: 1, name: "Person 1" }, { id: 2, name: "Person 2" }];
// Find index by findIndex
var index = _.findIndex(arr3, { id: 1 });

// Replace item at index using native splice
arr3.splice(index, 1, { id: 100, name: 'New Name.' });
console.log(arr3)

// Cách 2:
var arr4 = [{ id: 1, name: "Person 1" }, { id: 2, name: "Person 2" }];

var newArr = arr4.map(a => a.id === 1
  ? { id: a.id, name: a.name + " new" }
  : a);
console.log(newArr);

/**
 * Javascript - 
 *   Array multiple groupBy function
 *   Forked from http://codereview.stackexchange.com/questions/37028/grouping-elements-in-array-by-multiple-properties
 *
 * Usage:
 *   var list = [
 *     { foo: "bar", id: 1  },
 *     { foo: "barbar", id: 2  },
 *     { foo: "bar", id: 1  },
 *     { foo: "bar", id: 3  },
 *     { foo: "barbar", id: 2  },
 *   ];
 *   
 *   var newList = list.groupBy(function (item) {
 *     return [item.id]; 
 *   });
 */
if (!Array.prototype.groupBy) {
  Array.prototype.groupBy = function(f) {
    var groups = {};
    this.forEach(function(o) {
      var group = JSON.stringify(f(o));
      groups[group] = groups[group] || [];
      groups[group].push(o);
    });

    return Object.keys(groups).map(function(group) {
      return groups[group];
    });
  };
}